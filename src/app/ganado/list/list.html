<h2>Ganados</h2>

<table>
  <tr>
    <th>Número</th>
    <th>Fecha Compra</th>
    <th>Peso</th>
    <th>Clasificación</th>
    <th>Fecha Venta Estimada</th>
    <th>Acciones</th>
  </tr>

  <ng-container *ngFor="let g of ganados; let i = index">
    <!-- Fila principal -->
    <tr>
      <td>{{ g.numero }}</td>
      <td>{{ g.fecha_compra | date }}</td>
      <td>{{ g.peso }}</td>
      <td>{{ g.clasificacion }}</td>
      <td>{{ g.fecha_venta_estimada | date }}</td>
      <td>
        <button (click)="toggleHistorial(i)">
          {{ g.showHistorial ? 'Ocultar historial' : 'Ver historial' }}
        </button>
        <button (click)="g.showForm = !g.showForm" style="margin-left: 0.5rem;">
          Agregar revisión
        </button>
        <button (click)="venderGanado(g.id)" style="margin-left: 0.5rem; color: red;">
          Vender
        </button>
      </td>
    </tr>

    <!-- Formulario inline para agregar revisión -->
    <tr *ngIf="g.showForm">
      <td colspan="6">
        <div class="historial-form">
          <input type="number" placeholder="Peso" [(ngModel)]="g.nuevoPeso" />
          <input type="text" placeholder="Tipo" [(ngModel)]="g.nuevoTipo" />
          <input type="text" placeholder="Observaciones" [(ngModel)]="g.nuevaObs" />
          <input type="text" placeholder="Nombre Trabajador" [(ngModel)]="g.nuevoTrabajador" />
          <button (click)="agregarRevisionBackend(i)">Guardar</button>
        </div>
      </td>
    </tr>

    <!-- Fila desplegable con historial -->
    <tr *ngIf="g.showHistorial">
      <td colspan="6">
        <div class="historial">
          <ul>
            <li *ngFor="let r of g.revisiones">
              Fecha: {{ r.fecha_revision | date }}, 
              Tipo Rev: {{ r.tipo_revision }}, 
              Observaciones: {{ r.observaciones }}, 
              Peso: {{ r.peso }}, 
              Nombre Trabajador: {{ r.nombre_trabajador }}
            </li>
            <li *ngIf="g.revisiones?.length === 0">No hay historial disponible.</li>
          </ul>
        </div>
      </td>
    </tr>
  </ng-container>
</table>
